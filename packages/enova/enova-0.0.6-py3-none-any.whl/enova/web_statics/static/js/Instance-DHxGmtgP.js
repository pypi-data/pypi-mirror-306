import{o as oe,p as ne,q as se,f as re,g as ie,r as ue,s as de,t as ce,u as pe,v as me,w as _e,x as Z,y as fe,A as be,B as ve,C as ge,D as he,F as ye,G as we,H as ke,I as xe,J as Ce}from"./element-plus-3B-vNOz1.js";import{_ as Ve}from"./index-D14IUlo4.js";import{u as ee}from"./vue-i18n-CgiZb_CK.js";import{s as $e}from"./pinia-DJ7zjen1.js";import{x as De}from"./@element-plus-B4MVEBIT.js";import{u as te,c as Se,_ as Ee,a as Pe,b as Te,d as Ie,e as qe,f as Me,g as Be}from"./InstanceDetail.vue_vue_type_script_setup_true_lang-BLUZMVLs.js";import{a as Fe}from"./vue-router-1Rj2QA4q.js";import{d as ae,r as g,J as Le,o as s,c as m,O as e,R as t,a as f,W as p,P as V,a8 as q,u as N,V as $,S as x,X as v,e as H,k as Re,$ as Ue,ai as Ne,U as ze}from"./@vue-BH9fzvyO.js";import{u as Oe,a as We}from"./@vueuse-DzyAV02C.js";import"./lodash-es-BB-zMWwC.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-DxDECbvV.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@intlify-DCihH9S3.js";import"./axios-B6xwUs71.js";import"./echarts-BNE_GihJ.js";import"./tslib-BDyQ-Jie.js";import"./zrender-QwUp-Iho.js";const Ge={class:"w-full h-full pb-[84px] overflow-y-auto relative"},je={class:"collapse-title"},Ae={key:0,class:"inline-block w-20 text-primary text-sm"},Ke={class:"truncate text-gray5 text-sm"},Ye={class:"collapse-title"},He={class:"flex flex-row-reverse gap-3 w-1/2 p-4 bg-white z-[4] border-t border-gray2 fixed bottom-0 right-0"},Je=ae({__name:"TestConfig",emits:["closeConfig"],setup(le,{emit:c}){const P=Fe(),{t:D}=ee(),M=te(),z=g(["data","parameters"]),b=g(),O=Le({dataset:[{required:!0,message:"",trigger:"change"}],duration:[{required:!0,message:"",trigger:"change"}],distribution:[{required:!0,message:"",trigger:"change"}],mean:[{required:!0,message:"",trigger:"blur"}],std:[{required:!0,message:"",trigger:"blur"}],token:[{required:!0,message:"",trigger:"blur"}],temperature:[{required:!0,message:"",trigger:"blur"}],topP:[{required:!0,message:"",trigger:"blur"}]}),o=g({dataset:"",duration:"30",duration_unit:"min",distribution:"gaussian",mean:1,std:1,token:1024,temperature:.9,topP:.9,other:""}),T=[{value:"min",label:D("common.time.minute")},{value:"hour",label:D("common.time.hour")}],B=[{label:D("instance.title.sysDataset"),options:[{value:"GSM8K",tag:"GSM8K",label:"datasets of grade school math word problems",detail:"GSM8K is a dataset of 8.5K high quality linguistically diverse grade school math word problems created by human problem writers."},{value:"MBPP",tag:"MBPP",label:"datasets of Python programming problems",detail:"MBPP consists of around 1,000 Python programming problems, including entry-level programmers, covering programming fundamentals, standard library functionality, and so on."},{value:"ARC",tag:"ARC",label:"datasets of multiple-choice questions  from science exams ",detail:"ARC is a multiple-choice question-answering dataset, containing questions from science exams from grade 3 to grade 9. "},{value:"MC_Test",tag:"MCTest",label:"datasets of multiple-choice questions on machine comprehension",detail:"MCTest is a freely available set of stories and associated questions intended for research on the machine comprehension of text."}]},{label:D("instance.title.userDataset"),options:[]}],A=["1","3","5","15","30","60"].map(u=>({label:u,value:u})),F=[{value:"1",label:"params1"}],W=c,L=()=>{b.value!=null&&b.value.resetFields(),W("closeConfig")},h=g(!1),G=async()=>{b.value!=null&&await b.value.validate((u,n)=>{if(u){h.value=!0;const{dataset:R,duration:S,distribution:I,duration_unit:E,mean:_,std:a,token:r,temperature:y,topP:U}=o.value,w={instance_id:M.currentId,test_spec:{data_set:R,duration:S,distribution:I,duration_unit:E,tps_mean:_,tps_std:I==="gaussian"?a:_},param_spec:{max_tokens:r,temperature:y,top_p:U,others:""},creator:"admin"};Se(w).then(C=>{oe({message:D("experiment.inst.successTip"),type:"success",duration:3*1e3}),W("closeConfig"),P.push({name:"testRecord"})}).finally(()=>{h.value=!1})}})};return(u,n)=>{const R=fe,S=be,I=ve,E=ne,_=se,a=re,r=ie,y=ue,U=de,w=ce,C=pe,K=me,Y=_e,j=Z;return s(),m("div",Ge,[e(Y,{"label-position":"top",ref_key:"ruleFormRef",ref:b,rules:O,"label-width":"auto",model:o.value,style:{width:"100%"}},{default:t(()=>[e(K,{class:"config-collapse",modelValue:z.value,"onUpdate:modelValue":n[10]||(n[10]=l=>z.value=l)},{default:t(()=>[e(C,{name:"data"},{title:t(()=>[f("span",je,p(u.$t("common.title.data")),1)]),default:t(()=>[e(r,{gutter:24,class:"pt-5"},{default:t(()=>[e(a,{span:12},{default:t(()=>[e(_,{label:u.$t("common.title.dataset"),prop:"dataset"},{default:t(()=>[e(E,{modelValue:o.value.dataset,"onUpdate:modelValue":n[0]||(n[0]=l=>o.value.dataset=l),placeholder:u.$t("instance.inst.datasetPlaceholder"),"popper-class":"max-w-[800px]"},{default:t(()=>[(s(),m(V,null,q(B,l=>e(I,{key:l.label,label:l.label},{default:t(()=>[(s(!0),m(V,null,q(l.options,k=>(s(),x(S,{key:k.value,label:k.tag,value:k.value},{default:t(()=>[k.tag!=null?(s(),m("span",Ae,p(k.tag),1)):v("",!0),e(R,{effect:"dark",content:k.detail,placement:"bottom","show-after":100},{default:t(()=>[f("span",Ke,p(k.label),1)]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(a,{span:12},{default:t(()=>[e(_,{class:"injectTimeSelect",label:u.$t("instance.title.injectTime"),prop:"duration"},{default:t(()=>[e(E,{modelValue:o.value.duration,"onUpdate:modelValue":n[1]||(n[1]=l=>o.value.duration=l),placeholder:"Select"},{default:t(()=>[(s(!0),m(V,null,q(N(A),l=>(s(),x(S,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(E,{class:"suffix !w-20",modelValue:o.value.duration_unit,"onUpdate:modelValue":n[2]||(n[2]=l=>o.value.duration_unit=l),placeholder:"Select"},{default:t(()=>[(s(),m(V,null,q(T,l=>e(S,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(r,{gutter:24},{default:t(()=>[e(a,{span:24},{default:t(()=>[e(_,{label:u.$t("instance.title.distribution"),prop:"distribution"},{default:t(()=>[e(U,{modelValue:o.value.distribution,"onUpdate:modelValue":n[3]||(n[3]=l=>o.value.distribution=l)},{default:t(()=>[e(y,{value:"poisson"},{default:t(()=>[$(p(u.$t("instance.title.poisson")),1)]),_:1}),e(y,{value:"gaussian"},{default:t(()=>[$(p(u.$t("instance.title.traffic")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(r,{gutter:24},{default:t(()=>[e(a,{span:12},{default:t(()=>[e(_,{label:`Requests per Sec (${o.value.distribution==="poisson"?"Lambda":"Mean"})`,prop:"mean"},{default:t(()=>[e(w,{modelValue:o.value.mean,"onUpdate:modelValue":n[4]||(n[4]=l=>o.value.mean=l),min:0,"step-strictly":"",controls:!1,placeholder:"int, >0"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),o.value.distribution==="gaussian"?(s(),x(a,{key:0,span:12},{default:t(()=>[e(_,{label:"Requests per Sec (Std)",prop:"std"},{default:t(()=>[e(w,{modelValue:o.value.std,"onUpdate:modelValue":n[5]||(n[5]=l=>o.value.std=l),min:0,"step-strictly":"",controls:!1,placeholder:"int, >0"},null,8,["modelValue"])]),_:1})]),_:1})):v("",!0)]),_:1})]),_:1}),e(C,{name:"parameters"},{title:t(()=>[f("span",Ye,p(u.$t("common.title.parameters")),1)]),default:t(()=>[e(r,{gutter:24,class:"pt-5"},{default:t(()=>[e(a,{span:12},{default:t(()=>[e(_,{label:"max_tokens",prop:"token"},{default:t(()=>[e(w,{modelValue:o.value.token,"onUpdate:modelValue":n[6]||(n[6]=l=>o.value.token=l),min:0,max:4096,"step-strictly":"",controls:!1,placeholder:"int, >0 and < 4096"},null,8,["modelValue"])]),_:1})]),_:1}),e(a,{span:12},{default:t(()=>[e(_,{label:"temperature",prop:"temperature"},{default:t(()=>[e(w,{modelValue:o.value.temperature,"onUpdate:modelValue":n[7]||(n[7]=l=>o.value.temperature=l),min:0,max:1,step:.1,precision:1,"step-strictly":"",controls:!1,placeholder:"double, >0 and < 1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{gutter:24},{default:t(()=>[e(a,{span:12},{default:t(()=>[e(_,{label:"top_p",prop:"topP"},{default:t(()=>[e(w,{modelValue:o.value.topP,"onUpdate:modelValue":n[8]||(n[8]=l=>o.value.topP=l),min:0,max:1,step:.1,precision:1,"step-strictly":"",controls:!1,placeholder:"double, >0 and < 1"},null,8,["modelValue"])]),_:1})]),_:1}),v("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["rules","model"]),f("div",He,[e(j,{type:"primary",loading:h.value,onClick:G},{default:t(()=>[$(p(u.$t("instance.action.startTest")),1)]),_:1},8,["loading"]),e(j,{type:"",onClick:L},{default:t(()=>[$(p(u.$t("common.action.cancel")),1)]),_:1})])])}}}),Qe={class:"flex h-full flex-col pb-5 px-4"},Xe={class:"flex flex-col w-full h-full flex-1"},Ze={class:"flex justify-between flex-row-reverse items-center py-4"},et={class:"flex items-center justify-between relative h-full"},tt={class:"text-regular"},at=f("span",{class:"!absolute h-12 w-px bg-[#CDD0D6] right-8"},null,-1),lt={class:"inline-block"},ot={key:1,class:"flex items-center gap-3"},nt={key:2,class:"flex items-center gap-2"},st={key:3},rt=null,St=ae({__name:"Instance",setup(le){const{t:c}=ee(),P=te(),{currentId:D,instanceList:M,tableLoading:z}=$e(P),b=g(!1),O=g(""),o=g("detail"),T=g([]),B=g(""),A=H(()=>o.value==="detail"?c("instance.title.instanceDetail"):c("instance.title.testConfig")),F=H(()=>{if(B.value==="")return M.value;const a=B.value.toLocaleLowerCase();return M.value.filter(r=>{var y;return r.instance_name.toLowerCase().includes(a)||((y=h[r.deploy_status])==null?void 0:y.text.toLowerCase().includes(a))})}),W=H(()=>F.value.length===0?[]:[...new Set(F.value.map(a=>a.deploy_status))].map(a=>({text:h[a]?h[a].text:a,value:a}))),L=g([{prop:"instance_name",label:c("instance.title.instanceName"),sortable:!0,fixed:"left",minWidth:"200px"},{prop:"deploy_status",label:c("instance.title.deployStatus"),filterData:W,minWidth:"220px"},{prop:"create_time",label:c("common.title.createTime"),sortable:!0,minWidth:"200px"},{prop:"operation",label:c("common.title.operation"),fixed:"right",width:"300px"}]),h={pending:{color:"#909399",text:c("instance.title.deploying")},running:{color:"#67C23A",text:c("instance.title.deploySuccess")},failed:{color:"#F56C6C",text:c("instance.title.deployFail")},finsihed:{color:"#67C23A",text:c("instance.title.deploySuccess")},unknown:{color:"#909399",text:c("instance.title.deploying")},scheduling:{color:"#909399",text:c("instance.title.deploying")},error:{color:"#F56C6C",text:c("instance.title.deployFail")}},G=(a,r)=>{D.value=a.instance_id,O.value=a.instance_name,o.value=r,b.value=!0},u=a=>{Be(a).then(()=>{P.getInstanceList()})},n=a=>{B.value=a},R=()=>{const{protocol:a,hostname:r}=window.location;window.open(`${a}//${r}:8501`,"_blank")},{pause:S,resume:I}=Oe(()=>{P.getInstanceList()},15e3),E=()=>{qe(),S()},_=()=>{b.value=!1,I()};return Re(()=>{T.value=L.value.map(a=>a.prop),P.getInstanceList()}),(a,r)=>{const y=ye,U=we,w=ke,C=Z,K=Ve,Y=xe,j=Ce,l=ge,k=he;return s(),m("main",Qe,[e(Ee,{title:a.$t("instance.title.llmInstance"),count:N(M).length},null,8,["title","count"]),f("div",Xe,[f("div",Ze,[e(Pe,{"search-tips":a.$t("instance.inst.searchPlaceholder"),onChangeSearch:n},null,8,["search-tips"])]),Ue((s(),x(l,{class:"enova-table flex-1",data:F.value,style:{width:"100%"}},{default:t(()=>[(s(!0),m(V,null,q(L.value,i=>(s(),m(V,{key:i.prop},[T.value.includes(i.prop)?(s(),x(j,{key:0,prop:i.prop,label:i.label,fixed:i.fixed,"column-key":i.prop,sortable:i.sortable,"sort-orders":["ascending","descending"],filters:i.filterData,width:i.width,"min-width":i.minWidth},Ne({default:t(d=>{var J,Q;return[i.prop==="instance_name"?(s(),x(C,{key:0,link:"",type:"primary",size:"small",onClick:X=>G(d.row,"detail")},{default:t(()=>[$(p(d.row.instance_name),1)]),_:2},1032,["onClick"])):v("",!0),i.prop==="deploy_status"?(s(),m("div",ot,[f("span",{class:"shrink-0 w-3 h-3 block border-2 rounded-full",style:ze({borderColor:(J=h[d.row.deploy_status])==null?void 0:J.color})},null,4),f("span",null,p((Q=h[d.row.deploy_status])==null?void 0:Q.text),1)])):v("",!0),i.prop==="creator"?(s(),m("div",nt,[e(K,{name:"user",class:"shrink-0 text-[#c0c4cc]"}),f("span",null,p(d.row.creator),1)])):v("",!0),i.prop==="create_time"?(s(),m("span",st,p(N(We)(d.row.create_time,"YYYY-MM-DD HH:mm:ss").value),1)):v("",!0),i.prop==="operation"?(s(),m(V,{key:4},[e(C,{link:"",type:"primary",size:"small",onClick:X=>G(d.row,"config"),disabled:!["running","scheduling","unknown"].includes(d.row.deploy_status)},{default:t(()=>[$(p(a.$t("instance.action.inject")),1)]),_:2},1032,["onClick","disabled"]),v("",!0),e(C,{link:"",type:"primary",size:"small",disabled:d.row.deploy_status!=="running",onClick:R},{default:t(()=>[$(" WebUI ")]),_:2},1032,["disabled"]),e(Y,{title:a.$t("common.inst.deleteTips"),width:180,placement:"bottom-end","hide-icon":"",onConfirm:X=>u(d.row.instance_id)},{reference:t(()=>[e(C,{link:"",type:"primary",size:"small"},{default:t(()=>[$(p(a.$t("common.action.delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])],64)):v("",!0)]}),_:2},[i.prop==="operation"?{name:"header",fn:t(()=>[f("div",et,[f("span",tt,p(i.label),1),at,e(w,{placement:"bottom-end",width:rt,trigger:"click"},{reference:t(()=>[f("span",lt,[e(N(De),{class:"size-4 cursor-pointer outline-none"})])]),default:t(()=>[e(U,{class:"flex flex-col",modelValue:T.value,"onUpdate:modelValue":r[0]||(r[0]=d=>T.value=d)},{default:t(()=>[(s(!0),m(V,null,q(L.value,d=>(s(),x(y,{key:d.prop,label:d.label,value:d.prop,disabled:["instance_name","operation"].includes(d.prop),class:"!m-0"},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),key:"0"}:void 0]),1032,["prop","label","fixed","column-key","sortable","filters","width","min-width"])):v("",!0)],64))),128))]),_:1},8,["data"])),[[k,N(z)]]),e(Te,{pagination:{current_page:1,page_count:1,total:F.value.length}},null,8,["pagination"])]),e(Ie,{showDrawer:b.value,title:A.value,"title-desc":O.value,size:o.value==="detail"?"95%":"50%",onOpen:E,onCloseDrawer:_},{default:t(()=>[o.value==="detail"?(s(),x(Me,{key:0})):(s(),x(Je,{key:1,onCloseConfig:r[1]||(r[1]=i=>b.value=!1)}))]),_:1},8,["showDrawer","title","title-desc","size"])])}}});export{St as default};
