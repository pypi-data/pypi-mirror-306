name: generate-documentation
env:
  NAME_ENVIRONMENT_ARTIFACT: environment-artifact
  KPLER_ACTIONS_BRANCH: v1.0.2
  MAIN_BRANCH_NAME: master
  PYTHON_VERSION: 3.7

on:
  workflow_call:
    secrets:
      KPLER_BOT_PAT:
        required: true



jobs:

  generate-documentation:
    name: generate documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          token: ${{ secrets.KPLER_BOT_PAT }}
      - name: Restore Cache
        uses: actions/cache@v3
        with:
          path: ./setup.py
          key: v5-venv-${{ hashFiles('setup.py') }}
      - name: Upgrade pip and install rust compiler
        run: |
          python3 -m venv venv
          . venv/bin/activate
          sudo pip install --upgrade pip
          sudo apt update && sudo apt install rustc -y
      - name: Generate Python SDK documentation
        run: |
          python3 -m venv venv
          . venv/bin/activate
          pip install --upgrade pip
          pip install -e .[test,doc,publish]
          cd doc
          make clean
          make html
      - name: Save Cache
        uses: actions/cache@v3
        with:
          path: ./venv
          key: v5-venv-${{ hashFiles('setup.py') }}
