{% load custom_tags_and_filters %}
<div class="panel-body">
    <h3 class="customization-section-title">OsTicket settings</h3>
    <form method="POST" action="{% url 'customize' 'osticket' %}" class="form-horizontal">
        {% csrf_token %}
        <div class="form-group">
            <label class="control-label col-md-3" for="osticket_tool_control_replace_problem_tab">Tool control tab</label>
            <div class="col-md-7">
                <div class="radio">
                    <label>
                        <input type="radio"
                               id="osticket_tool_control_replace_problem_tab"
                               name="osticket_tool_control_replace_problem_tab"
                               value="enabled"
                               {% if osticket_tool_control_replace_problem_tab %}checked{% endif %}>
                        Replace tool problems tab
                    </label>
                    <br>
                    <label>
                        <input type="radio"
                               name="osticket_tool_control_replace_problem_tab"
                               value=""
                               {% if not osticket_tool_control_replace_problem_tab %}checked{% endif %}>
                        Add new tab
                    </label>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-3" for="osticket_tool_control_tab_name">Tab name</label>
            <div class="col-md-7">
                <input class="form-control"
                       type="text"
                       id="osticket_tool_control_tab_name"
                       name="osticket_tool_control_tab_name"
                       value="{{ osticket_tool_control_tab_name }}" />
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-3" for="osticket_tool_matching_field_id">Tool matching field</label>
            <div class="col-md-7">
                <select id="osticket_tool_matching_field_id" name="osticket_tool_matching_field_id" class="form-control">
                    <option value="" selected></option>
                    {% for ticket_form_field in ticket_form_fields %}
                        <option value="{{ ticket_form_field.id }}"
                                {% if osticket_tool_matching_field_id|to_int == ticket_form_field.id %}selected{% endif %}>
                            {{ ticket_form_field.label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="form-group {% if errors.osticket_tool_matching_nemo_property_template %}has-error{% endif %}">
            <label class="control-label col-md-3" for="osticket_tool_matching_nemo_property_template">
                Tool property template
            </label>
            <div class="col-md-7">
                <textarea id="osticket_tool_matching_nemo_property_template"
                          name="osticket_tool_matching_nemo_property_template"
                          class="form-control">{{ osticket_tool_matching_nemo_property_template|default_if_none:"" }}</textarea>
            </div>
            {% if errors.osticket_tool_matching_nemo_property_template %}
                <div class="col-md-offset-3 col-md-9 help-block light-grey">
                    {{ errors.osticket_tool_matching_nemo_property_template.error }}
                </div>
            {% endif %}
            <div class="col-md-offset-3 col-md-7 help-block">
                Set the template for getting the matching field from the tool.
                The variable <b>tool</b> is provided.
            </div>
        </div>
        <div class="form-group {% if errors.osticket_tool_matching_property_extract_re %}has-error{% endif %}">
            <label class="control-label col-md-3" for="osticket_tool_matching_property_extract_re">
                Extraction template (regex)
            </label>
            <div class="col-md-7">
                <textarea id="osticket_tool_matching_property_extract_re"
                          name="osticket_tool_matching_property_extract_re"
                          class="form-control">{{ osticket_tool_matching_property_extract_re|default_if_none:"" }}</textarea>
            </div>
            {% if errors.osticket_tool_matching_property_extract_re %}
                <div class="col-md-offset-3 col-md-9 help-block light-grey">
                    {{ errors.osticket_tool_matching_property_extract_re.error }}
                </div>
            {% endif %}
            <div class="col-md-offset-3 col-md-7 help-block">
                Create an [optional] regular expression to extract the matching value from the field in OsTicket.
            </div>
        </div>
        <div class="customization-separation" style="margin-bottom: 15px;"></div>
        <div class="form-group">
            <div class="text-center">{% button type="save" value="Save settings" %}</div>
        </div>
    </form>
</div>
<script>auto_size_textarea(document.getElementById("osticket_tool_matching_nemo_property_template"));</script>
