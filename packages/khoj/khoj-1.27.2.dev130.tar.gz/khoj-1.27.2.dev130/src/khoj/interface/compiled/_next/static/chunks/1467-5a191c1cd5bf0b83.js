(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1467],{81467:function(e,t,n){"use strict";n.d(t,{Z:function(){return T}});var a=n(57437),s=n(15238),o=n.n(s),l=n(2265),r=n(53423),i=n(94880),c=n(58485),u=n(52195);let d=new Map([["bold",l.createElement(l.Fragment,null,l.createElement("path",{d:"M168.49,104.49,145,128l23.52,23.51a12,12,0,0,1-17,17L128,145l-23.51,23.52a12,12,0,0,1-17-17L111,128,87.51,104.49a12,12,0,0,1,17-17L128,111l23.51-23.52a12,12,0,0,1,17,17ZM236,128A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Z"}))],["duotone",l.createElement(l.Fragment,null,l.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),l.createElement("path",{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["fill",l.createElement(l.Fragment,null,l.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm37.66,130.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32L139.31,128Z"}))],["light",l.createElement(l.Fragment,null,l.createElement("path",{d:"M164.24,100.24,136.48,128l27.76,27.76a6,6,0,1,1-8.48,8.48L128,136.48l-27.76,27.76a6,6,0,0,1-8.48-8.48L119.52,128,91.76,100.24a6,6,0,0,1,8.48-8.48L128,119.52l27.76-27.76a6,6,0,0,1,8.48,8.48ZM230,128A102,102,0,1,1,128,26,102.12,102.12,0,0,1,230,128Zm-12,0a90,90,0,1,0-90,90A90.1,90.1,0,0,0,218,128Z"}))],["regular",l.createElement(l.Fragment,null,l.createElement("path",{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["thin",l.createElement(l.Fragment,null,l.createElement("path",{d:"M162.83,98.83,133.66,128l29.17,29.17a4,4,0,0,1-5.66,5.66L128,133.66,98.83,162.83a4,4,0,0,1-5.66-5.66L122.34,128,93.17,98.83a4,4,0,0,1,5.66-5.66L128,122.34l29.17-29.17a4,4,0,1,1,5.66,5.66ZM228,128A100,100,0,1,1,128,28,100.11,100.11,0,0,1,228,128Zm-8,0a92,92,0,1,0-92,92A92.1,92.1,0,0,0,220,128Z"}))]]);var g=Object.defineProperty,h=Object.defineProperties,m=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,x=(e,t,n)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))f.call(t,n)&&x(e,n,t[n]);if(v)for(var n of v(t))p.call(t,n)&&x(e,n,t[n]);return e},b=(e,t)=>h(e,m(t));let j=(0,l.forwardRef)((e,t)=>l.createElement(u.Z,b(y({ref:t},e),{weights:d})));j.displayName="XCircle";var M=n(16288),C=n(20721),w=n(26100),N=n(19666),L=n(50495),E=e=>{let{name:t,avatar:n,link:s,description:o}=e;return(0,a.jsx)("div",{className:"relative group flex",children:(0,a.jsx)(N.pn,{children:(0,a.jsxs)(N.u,{delayDuration:0,children:[(0,a.jsx)(N.aJ,{asChild:!0,children:(0,a.jsxs)(L.z,{variant:"ghost",className:"flex items-center justify-center",children:[n,(0,a.jsx)("div",{children:t})]})}),(0,a.jsx)(N._v,{children:(0,a.jsxs)("div",{className:"w-80 h-30",children:[(0,a.jsx)("a",{href:s,target:"_blank",rel:"noreferrer",className:"mt-1 ml-2 block no-underline",children:(0,a.jsxs)("div",{className:"flex items-center justify-start gap-2",children:[n,(0,a.jsxs)("div",{className:"mr-2 mt-1 flex justify-center items-center text-sm font-semibold text-gray-800",children:[t,(0,a.jsx)(w.o,{weight:"bold",className:"ml-1"})]})]})}),o&&(0,a.jsx)("p",{className:"mt-2 ml-6 text-sm text-gray-600 line-clamp-2",children:o||"A Khoj agent"})]})})]})})})},O=n(89417),Z=n(69591);function _(e){let t=e.trainOfThought.length-1,[n,s]=(0,l.useState)(e.completed);return(0,a.jsxs)("div",{className:"".concat(n?"":o().trainOfThought+" shadow-sm"),children:[!e.completed&&(0,a.jsx)(c.l,{className:"float-right"}),e.completed&&(n?(0,a.jsx)(L.z,{className:"w-fit text-left justify-start content-start text-xs",onClick:()=>s(!1),variant:"ghost",size:"sm",children:"What was my train of thought?"}):(0,a.jsxs)(L.z,{className:"w-fit text-left justify-start content-start text-xs p-0 h-fit",onClick:()=>s(!0),variant:"ghost",size:"sm",children:[(0,a.jsx)(j,{size:16,className:"mr-1"}),"Close"]})),!n&&e.trainOfThought.map((n,s)=>(0,a.jsx)(r.H,{message:n,primary:s===t&&e.lastMessage&&!e.completed,agentColor:e.agentColor},"train-".concat(s)))]},e.key)}function T(e){var t,n,s,u,d,g,h,m,v;let[f,p]=(0,l.useState)(null),[x,y]=(0,l.useState)(0),[b,j]=(0,l.useState)(!0),w=(0,l.useRef)(null),N=(0,l.useRef)(null),L=(0,l.useRef)(null),T=(0,l.useRef)(null),[A,k]=(0,l.useState)(null),[I,S]=(0,l.useState)(!1),[H,F]=(0,l.useState)(!0),q=(0,Z.IC)(),z="[data-radix-scroll-area-viewport]";(0,l.useEffect)(()=>{var e;let t=null===(e=N.current)||void 0===e?void 0:e.querySelector(z);if(!t)return;let n=()=>{let{scrollTop:e,scrollHeight:n,clientHeight:a}=t;F(n-(e+a)<=50)};return t.addEventListener("scroll",n),()=>t.removeEventListener("scroll",n)},[]),(0,l.useEffect)(()=>{e.incomingMessages&&e.incomingMessages.length>0&&H&&Q()},[e.incomingMessages,H]),(0,l.useEffect)(()=>{f&&f.chat&&f.chat.length>0&&x<2&&requestAnimationFrame(()=>{var e;null===(e=L.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"start"})})},[f,x]),(0,l.useEffect)(()=>{if(!b||I)return;let t=new IntersectionObserver(t=>{t[0].isIntersecting&&b&&(S(!0),function(t){if(!b||I)return;let n=(t+1)*10,a="";if(e.conversationId)a="/api/chat/history?client=web&conversation_id=".concat(encodeURIComponent(e.conversationId),"&n=").concat(n);else{if(!e.publicConversationSlug)return;a="/api/chat/share/history?client=web&public_conversation_slug=".concat(e.publicConversationSlug,"&n=").concat(n)}fetch(a).then(e=>e.json()).then(n=>{if(e.setTitle(n.response.slug),n&&n.response&&n.response.chat&&n.response.chat.length>0){if(y(Math.ceil(n.response.chat.length/10)),n.response.chat.length===(null==f?void 0:f.chat.length)){j(!1),S(!1);return}e.setAgent(n.response.agent),p(n.response),S(!1),0===t?Q(!0):R()}else{if(n.response.agent&&n.response.conversation_id){let t={chat:[],agent:n.response.agent,conversation_id:n.response.conversation_id,slug:n.response.slug};e.setAgent(n.response.agent),p(t)}j(!1),S(!1)}}).catch(e=>{console.error(e),window.location.href="/"})}(x))},{threshold:1});return w.current&&t.observe(w.current),()=>t.disconnect()},[b,x,I]),(0,l.useEffect)(()=>{j(!0),S(!1),y(0),p(null)},[e.conversationId]),(0,l.useEffect)(()=>{if(e.incomingMessages){let t=e.incomingMessages[e.incomingMessages.length-1];t&&!t.completed&&(k(e.incomingMessages.length-1),e.setTitle(t.rawQuery))}},[e.incomingMessages]);let R=()=>{var e;let t=null===(e=N.current)||void 0===e?void 0:e.querySelector(z);requestAnimationFrame(()=>{var e;null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"start"}),null==t||t.scrollBy({behavior:"smooth",top:-150})})},Q=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=null===(e=N.current)||void 0===e?void 0:e.querySelector(z);requestAnimationFrame(()=>{null==n||n.scrollTo({top:n.scrollHeight,behavior:t?"auto":"smooth"})}),F(!0)};return e.conversationId||e.publicConversationSlug?(0,a.jsx)(i.x,{className:"h-[73vh] relative",ref:N,children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"".concat(o().chatHistory," ").concat(e.customClassName),children:[(0,a.jsx)("div",{ref:w,style:{height:"1px"},children:I&&(0,a.jsx)(c.l,{className:"opacity-50"})}),f&&f.chat&&f.chat.map((e,t)=>{var n,s,o;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{ref:t===f.chat.length-2?L:t===f.chat.length-(x-1)*10?T:null,isMobileWidth:q,chatMessage:e,customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(n=f.agent)||void 0===n?void 0:n.color,"-500"),isLastMessage:t===f.chat.length-1},"".concat(t,"fullHistory")),e.trainOfThought&&"khoj"===e.by&&(0,a.jsx)(_,{trainOfThought:null===(s=e.trainOfThought)||void 0===s?void 0:s.map(e=>e.data),lastMessage:!1,agentColor:(null==f?void 0:null===(o=f.agent)||void 0===o?void 0:o.color)||"orange",completed:!0},"".concat(t,"trainOfThought"))]})}),e.incomingMessages&&e.incomingMessages.map((e,t)=>{var n,s,o;return(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)(r.Z,{isMobileWidth:q,chatMessage:{message:e.rawQuery,context:[],onlineContext:{},codeContext:{},created:e.timestamp,by:"you",automationId:"",images:e.images},customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(n=f.agent)||void 0===n?void 0:n.color,"-500")},"".concat(t,"outgoing")),e.trainOfThought&&(0,a.jsx)(_,{trainOfThought:e.trainOfThought,lastMessage:t===A,agentColor:(null==f?void 0:null===(s=f.agent)||void 0===s?void 0:s.color)||"orange",completed:e.completed},"".concat(t,"trainOfThought")),(0,a.jsx)(r.Z,{isMobileWidth:q,chatMessage:{message:e.rawResponse,context:e.context,onlineContext:e.onlineContext,codeContext:e.codeContext,created:e.timestamp,by:"khoj",automationId:"",rawQuery:e.rawQuery,intent:{type:e.intentType||"",query:e.rawQuery,"memory-type":"","inferred-queries":e.inferredQueries||[]}},customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(o=f.agent)||void 0===o?void 0:o.color,"-500"),isLastMessage:!0},"".concat(t,"incoming"))]},"incomingMessage".concat(t))}),e.pendingMessage&&(0,a.jsx)(r.Z,{isMobileWidth:q,chatMessage:{message:e.pendingMessage,context:[],onlineContext:{},codeContext:{},created:new Date().getTime().toString(),by:"you",automationId:""},customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(t=f.agent)||void 0===t?void 0:t.color,"-500"),isLastMessage:!0},"pendingMessage-".concat(e.pendingMessage.length)),f&&(0,a.jsx)("div",{className:"".concat(o().agentIndicator," pb-4"),children:(0,a.jsx)("div",{className:"relative group mx-2 cursor-pointer",children:(0,a.jsx)(E,{name:f&&f.agent&&(null===(u=f.agent)||void 0===u?void 0:u.name)?null===(d=f.agent)||void 0===d?void 0:d.name:"Agent",link:f&&f.agent&&(null===(g=f.agent)||void 0===g?void 0:g.slug)?"/agents?agent=".concat(null===(h=f.agent)||void 0===h?void 0:h.slug):"/agents",avatar:(0,O.TI)(null===(n=f.agent)||void 0===n?void 0:n.icon,null===(s=f.agent)||void 0===s?void 0:s.color)||(0,a.jsx)(M.v,{}),description:f&&f.agent&&(null===(m=f.agent)||void 0===m?void 0:m.persona)?null===(v=f.agent)||void 0===v?void 0:v.persona:"Your agent is no longer available. You will be reset to the default agent."})})})]}),(0,a.jsx)("div",{className:"".concat(e.customClassName," fixed bottom-[20%] z-10"),children:!H&&(0,a.jsx)("button",{title:"Scroll to bottom",className:"absolute bottom-0 right-0 bg-white dark:bg-[hsl(var(--background))] text-neutral-500 dark:text-white p-2 rounded-full shadow-xl",onClick:()=>{Q(),F(!0)},children:(0,a.jsx)(C.K,{size:24})})})]})}):null}},15238:function(e){e.exports={chatHistory:"chatHistory_chatHistory__CoaVT",agentIndicator:"chatHistory_agentIndicator__wOU1f",trainOfThought:"chatHistory_trainOfThought__mMWSR"}}}]);