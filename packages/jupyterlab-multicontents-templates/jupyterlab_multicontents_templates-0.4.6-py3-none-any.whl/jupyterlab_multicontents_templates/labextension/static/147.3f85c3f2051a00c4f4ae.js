"use strict";(self.webpackChunkjupyterlab_multicontents_templates=self.webpackChunkjupyterlab_multicontents_templates||[]).push([[147],{147:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(353),s=n(30),o=n(345),l=n.n(o),i=n(537),r=n(778);async function c(e="",t={}){const n=r.ServerConnection.makeSettings(),a=i.URLExt.join(n.baseUrl,"jupyterlab_multicontents_templates",e);let s;try{s=await r.ServerConnection.makeRequest(a,t,n)}catch(e){throw new r.ServerConnection.NetworkError(e)}let o=await s.text();if(o.length>0)try{o=JSON.parse(o)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new r.ServerConnection.ResponseError(s,o.message||o);return o}class m extends l().Component{constructor(e){super(e),this.state={items:null,expandChild:!1,loading:!1}}render(){let e=(this.state.items||[]).map((e=>"directory"===e.type?l().createElement(m,{name:e.name,path:e.path,isRoot:!1,onSelect:this.props.onSelect,onContextMenu:this.props.onContextMenu}):"notebook"===e.type?l().createElement("li",{className:"template-item template-notebook"},l().createElement("a",{onClick:()=>this.props.onSelect(e),onContextMenu:()=>this.props.onContextMenu(e)},l().createElement("div",null,l().createElement("span",{className:"jp-multicontents-templates-item-icon"}),l().createElement("span",null,e.name)))):void 0));return this.state.loading&&(e=[l().createElement("li",null,l().createElement("div",{className:"loader"}))]),this.props.isRoot?l().createElement("ul",{className:"template-folder multicontents-templates-ul"}," ",e," "):l().createElement("li",{className:"template-item"},l().createElement("a",{onClick:()=>this.toggle()},l().createElement("div",null,l().createElement("span",{className:null===this.state.items?"jp-multicontents-templates-folded-folder-icon":"jp-multicontents-templates-expanded-folder-icon"}),l().createElement("span",null,this.props.name))),l().createElement("ul",{className:"multicontents-templates-ul"},e," "))}componentDidMount(){this.props.isRoot&&this.expand()}toggle(){const e=!this.state.expandChild;this.props.onSelect({name:this.props.path,path:this.props.path,type:"directory"}),this.setState({expandChild:e}),e?this.expand():this.setState({items:null})}expand(){null===this.state.items&&(this.setState({loading:!0}),c("list",{method:"PUT",body:JSON.stringify({path:this.props.path})}).then((e=>{this.setState({items:e.content,loading:!1})})).catch((e=>{console.error(`Error: ${e}`),this.setState({loading:!1})})))}}class p extends s.ReactWidget{constructor(e,t){super(),this.addClass("jp-ReactWidget"),this.title.iconClass="jp-multicontents-templates-icon",this.title.caption="Templates",this.title.closable=!0,this.onSelect=e,this.onContextMenu=t}render(){return l().createElement("div",{className:"multicontents-templates"},l().createElement("h1",null," Templates "),l().createElement(m,{isRoot:!0,onSelect:this.onSelect,onContextMenu:this.onContextMenu}))}}class h extends l().Component{constructor(e){super(e),this.state={targetPath:null}}render(){return l().createElement("div",null,l().createElement("label",null,"Save to:"),l().createElement("input",{value:this.state.targetPath,onChange:this.handleChange.bind(this),className:"multicontents-save-input"}),l().createElement(m,{isRoot:!0,onSelect:this.onSelect.bind(this)}))}change(e){this.setState({targetPath:e}),this.props.valueFunc(e)}onSelect(e){let t;t="directory"===e.type?e.path+"/"+this.props.srcNotebook.name:e.path,this.change(t)}handleChange(e){this.change(e.target.value)}}class u extends s.ReactWidget{constructor(e){super(),this.srcNotebook=e}render(){return l().createElement("div",null,l().createElement(h,{srcNotebook:this.srcNotebook,valueFunc:this.setValue}))}setValue(e){console.log(`Updated value: ${e}`),u.value=e}getValue(){return u.value}}class d extends s.ReactWidget{constructor(e,t,n){super(),this.name=t,this.path=e,this.importFunc=n}render(){const e=r.ServerConnection.makeSettings(),t=encodeURIComponent(this.path),n=i.URLExt.join(e.baseUrl,"jupyterlab_multicontents_templates",`preview?path=${t}`);return l().createElement("div",{style:{width:"100%",height:"100%"}},l().createElement("div",null,l().createElement("input",{type:"button",value:"Import",style:{margin:"2px",padding:"2px 5px 2px 5px",color:"white",backgroundColor:"#0a6de6",border:"2px solid #0a6de6",borderRadius:"2px"},onClick:()=>this.importFunc(this.path)})),l().createElement("iframe",{style:{width:"100%",height:"100%"},src:n}))}}class g extends s.MainAreaWidget{constructor(e,t,n){super({content:new d(e,t,n)}),this.id="MulticontentsTemplates-preview",this.title.label=`Preview: ${t}`,this.title.closable=!0}}class b extends l().Component{constructor(e){super(e),this.state={shareURL:null},c("share-link",{method:"PUT",body:JSON.stringify({path:this.props.path})}).then((e=>{this.setState({shareURL:new URL(e.path,window.location.href).href})}))}render(){return this.state.shareURL&&s.Clipboard.copyToSystem(this.state.shareURL),l().createElement("div",{className:"share-link"},l().createElement("div",null,"Share with this link: (Already copied to clipboard)"),l().createElement("div",{className:"share-link-url"},l().createElement("input",{onClick:e=>{e.target.select()},className:"share-link-input",value:this.state.shareURL})))}}class x extends s.ReactWidget{constructor(e){super(),this.path=e.path}render(){return l().createElement(b,{path:this.path})}}const y={id:"jupyterlab_multicontents_templates:plugin",autoStart:!0,requires:[a.IFileBrowserFactory,a.IDefaultFileBrowser],activate:(e,t,n)=>{const a=new p((t=>{"notebook"===t.type&&e.commands.execute("multicontentTemplates:preview",{path:t.path,name:t.name})}),(t=>{e.commands.execute("multicontentTemplates:set-context",{path:t.path,name:t.name})})),{tracker:o}=t;let l=null;a.id="template:list",e.shell.add(a,"left"),e.commands.addCommand("multicontentTemplates:preview",{caption:"Preview Template Notebook",execute:t=>{null!==l&&l.close(),l=new g(String(t.path),String(t.name),(t=>{e.commands.execute("multicontentTemplates:import",{path:t})})),l.isAttached||e.shell.add(l,"main"),e.shell.activateById(l.id)}}),e.commands.addCommand("multicontentTemplates:import",{caption:"import notebook",execute:t=>{const a=String(t.path);c("content",{method:"PUT",body:JSON.stringify({path:a})}).then((t=>{const a=n.model.path;return new Promise((n=>{e.commands.execute("docmanager:new-untitled",{path:a,type:"notebook"}).then((t=>(l.close(),e.commands.execute("docmanager:open",{factory:"Notebook",path:t.path})))).then((e=>e.context.ready.then((()=>{e.model.fromJSON(t.content),n(e)})))).then((()=>e.commands.execute("docmanager:save")))}))}))}}),e.commands.addCommand("multicontentTemplates:publish",{label:"Publish Notebook",iconClass:"jp-multicontents-templates-icon",execute:e=>{const t=o.currentWidget.selectedItems().next();(0,s.showDialog)({title:"Publish Location",body:new u(t.value),buttons:[s.Dialog.cancelButton(),s.Dialog.okButton({label:"Publish"})]}).then((e=>{"Publish"===e.button.label&&c("publish",{method:"PUT",body:JSON.stringify({source_path:t.value.path,target_path:e.value})}).then((e=>{(0,s.showDialog)({title:"Success!",body:`successfully saved template to: ${e.path}`,buttons:[s.Dialog.okButton()]})})).catch((e=>{(0,s.showDialog)({title:"Error",body:e.message,buttons:[s.Dialog.okButton()]})}))}))}}),e.contextMenu.addItem({command:"multicontentTemplates:publish",selector:'.jp-DirListing-item[data-file-type="notebook"]',rank:3});const i=new URLSearchParams(window.location.search);if(i.get("template-preview")){const t=i.get("template-preview");c("decode-link",{method:"PUT",body:JSON.stringify({path:t})}).then((t=>{const n=t.path,a=t.path.split("/").pop();console.log(`Found preview path: ${n}`),Promise.all([e.restored]).then((()=>{e.commands.execute("multicontentTemplates:preview",{path:n,name:a})}))}))}let r;e.commands.addCommand("multicontentTemplates:set-context",{label:"set context",execute:e=>{r={path:String(e.path),name:String(e.name)}}}),e.commands.addCommand("multicontentTemplates:share-templates",{label:"Share Template",execute:e=>{(0,s.showDialog)({title:"Share URL",body:new x({path:String(r.path),name:String(r.name),type:"notebook"}),buttons:[s.Dialog.okButton()]})}}),e.contextMenu.addItem({command:"multicontentTemplates:share-templates",selector:".template-notebook"}),console.log("JupyterLab extension jupyterlab_multicontents_templates is activated!")}}}}]);