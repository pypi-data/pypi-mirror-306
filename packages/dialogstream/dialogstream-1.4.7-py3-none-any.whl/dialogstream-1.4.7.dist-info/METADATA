Metadata-Version: 2.1
Name: dialogstream
Version: 1.4.7
Summary: A flexible stream routing and filtering system with support for scheduled tasks and event reactions
Home-page: https://github.com/pipexy/stream-filter-router
Author: Tom Sapletta
Author-email: info@softreck.dev
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Developers
Classifier: Topic :: Multimedia :: Video
Classifier: Topic :: System :: Systems Administration
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Operating System :: POSIX :: Linux
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pyyaml>=6.0
Requires-Dist: python-dotenv>=0.19.0
Requires-Dist: ffmpeg-python>=0.2.0
Requires-Dist: typing-extensions>=4.0.0
Requires-Dist: colorlog>=6.7.0
Requires-Dist: click>=8.0.0
Requires-Dist: prometheus-client>=0.19.0
Requires-Dist: fastapi>=0.104.1
Requires-Dist: uvicorn>=0.24.0

<img alt="Dialogstream logo" src="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNDcwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMCwgNDUpIj4KICAgIDwhLS0gUm90YXRpbmcgd2F2ZXMgZ3JvdXAgLS0+CiAgICA8Zz4KICAgICAgPGFuaW1hdGVUcmFuc2Zvcm0KICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iCiAgICAgICAgICAgICAgdHlwZT0icm90YXRlIgogICAgICAgICAgICAgIGZyb209IjAiCiAgICAgICAgICAgICAgdG89IjM2MCIKICAgICAgICAgICAgICBkdXI9IjZzIgogICAgICAgICAgICAgIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIgogICAgICAgICAgICAgIGNhbGNNb2RlPSJsaW5lYXIiCiAgICAgIC8+CgogICAgICA8IS0tIFNpbiB3YXZlIC0tPgogICAgICA8cGF0aCBkPSJNLTQwIDAgQy0zMCAtMjAgLTE1IC0yMCAwIDAgQzE1IDIwIDMwIDIwIDQwIDAiCiAgICAgICAgICAgIGZpbGw9Im5vbmUiCiAgICAgICAgICAgIHN0cm9rZT0iIzAwOTVGRiIKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoPSIyLjUiCiAgICAgICAgICAgIG9wYWNpdHk9IjAuOTUiPgogICAgICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImQiCiAgICAgICAgICAgICAgICAgZHVyPSIycyIKICAgICAgICAgICAgICAgICByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKICAgICAgICAgICAgICAgICB2YWx1ZXM9Ik0tNDAgMCBDLTMwIC0yMCAtMTUgLTIwIDAgMCBDMTUgMjAgMzAgMjAgNDAgMDsKICAgICAgICAgICAgICAgICAgICAgICAgTS00MCAwIEMtMzAgLTIgLTE1IC0yIDAgMCBDMTUgMiAzMCAyIDQwIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIE0tNDAgMCBDLTMwIC0yMCAtMTUgLTIwIDAgMCBDMTUgMjAgMzAgMjAgNDAgMCIvPgogICAgICA8L3BhdGg+CgogICAgICA8IS0tIENvcyB3YXZlIC0tPgogICAgICA8cGF0aCBkPSJNLTQwIDAgQy0zMCAyMCAtMTUgMjAgMCAwIEMxNSAtMjAgMzAgLTIwIDQwIDAiCiAgICAgICAgICAgIGZpbGw9Im5vbmUiCiAgICAgICAgICAgIHN0cm9rZT0iIzAwRTVGRiIKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoPSIyLjUiCiAgICAgICAgICAgIG9wYWNpdHk9IjAuOTUiPgogICAgICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImQiCiAgICAgICAgICAgICAgICAgZHVyPSIycyIKICAgICAgICAgICAgICAgICByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIKICAgICAgICAgICAgICAgICB2YWx1ZXM9Ik0tNDAgMCBDLTMwIDIwIC0xNSAyMCAwIDAgQzE1IC0yMCAzMCAtMjAgNDAgMDsKICAgICAgICAgICAgICAgICAgICAgICAgTS00MCAwIEMtMzAgMiAtMTUgMiAwIDAgQzE1IC0yIDMwIC0yIDQwIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIE0tNDAgMCBDLTMwIDIwIC0xNSAyMCAwIDAgQzE1IC0yMCAzMCAtMjAgNDAgMCIvPgogICAgICA8L3BhdGg+CgogICAgICA8IS0tIFZlcnRpY2FsIHdhdmVzIC0tPgogICAgICA8cGF0aCBkPSJNLTQwIDAgQy0zMCAtMjAgLTE1IC0yMCAwIDAgQzE1IDIwIDMwIDIwIDQwIDAiCiAgICAgICAgICAgIGZpbGw9Im5vbmUiCiAgICAgICAgICAgIHN0cm9rZT0iI0ZGMkQ1NSIKICAgICAgICAgICAgc3Ryb2tlLXdpZHRoPSIyLjUiCiAgICAgICAgICAgIG9wYWNpdHk9IjAuOTUiCiAgICAgICAgICAgIHRyYW5zZm9ybT0icm90YXRlKDkwKSI+CiAgICAgICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIKICAgICAgICAgICAgICAgICBkdXI9IjJzIgogICAgICAgICAgICAgICAgIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIgogICAgICAgICAgICAgICAgIHZhbHVlcz0iTS00MCAwIEMtMzAgLTIwIC0xNSAtMjAgMCAwIEMxNSAyMCAzMCAyMCA0MCAwOwogICAgICAgICAgICAgICAgICAgICAgICBNLTQwIDAgQy0zMCAtMiAtMTUgLTIgMCAwIEMxNSAyIDMwIDIgNDAgMDsKICAgICAgICAgICAgICAgICAgICAgICAgTS00MCAwIEMtMzAgLTIwIC0xNSAtMjAgMCAwIEMxNSAyMCAzMCAyMCA0MCAwIi8+CiAgICAgIDwvcGF0aD4KCiAgICAgIDxwYXRoIGQ9Ik0tNDAgMCBDLTMwIDIwIC0xNSAyMCAwIDAgQzE1IC0yMCAzMCAtMjAgNDAgMCIKICAgICAgICAgICAgZmlsbD0ibm9uZSIKICAgICAgICAgICAgc3Ryb2tlPSIjRkY5NTAwIgogICAgICAgICAgICBzdHJva2Utd2lkdGg9IjIuNSIKICAgICAgICAgICAgb3BhY2l0eT0iMC45NSIKICAgICAgICAgICAgdHJhbnNmb3JtPSJyb3RhdGUoOTApIj4KICAgICAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJkIgogICAgICAgICAgICAgICAgIGR1cj0iMnMiCiAgICAgICAgICAgICAgICAgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiCiAgICAgICAgICAgICAgICAgdmFsdWVzPSJNLTQwIDAgQy0zMCAyMCAtMTUgMjAgMCAwIEMxNSAtMjAgMzAgLTIwIDQwIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIE0tNDAgMCBDLTMwIDIgLTE1IDIgMCAwIEMxNSAtMiAzMCAtMiA0MCAwOwogICAgICAgICAgICAgICAgICAgICAgICBNLTQwIDAgQy0zMCAyMCAtMTUgMjAgMCAwIEMxNSAtMjAgMzAgLTIwIDQwIDAiLz4KICAgICAgPC9wYXRoPgoKICAgICAgPCEtLSBSZWNvcmRpbmcgZG90IC0tPgogICAgICA8Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iNiIKICAgICAgICAgICAgICBmaWxsPSJ1cmwoI2RvdEdyYWRpZW50KSIKICAgICAgICAgICAgICBmaWx0ZXI9InVybCgjcmVkR2xvdykiLz4KICAgIDwvZz4KICA8L2c+CgogIDwhLS0gU3RhdGljIHRleHQgLS0+CiAgPGcgY2xhc3M9InRleHQtZGFyayI+CiAgICA8dGV4dCB4PSIxNTAiIHk9IjU1IgogICAgICAgICAgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIgogICAgICAgICAgZm9udC1zaXplPSI0OCIKICAgICAgICAgIGZvbnQtd2VpZ2h0PSJib2xkIgogICAgICAgICAgZmlsbD0iIzJCNUJBOSI+CiAgICAgIERpYWxvZzx0c3BhbiBmaWxsPSIjMDA5NUZGIj5TdHJlYW08L3RzcGFuPgogICAgPC90ZXh0PgogIDwvZz4KCiAgPGRlZnM+CiAgICA8cmFkaWFsR3JhZGllbnQgaWQ9ImRvdEdyYWRpZW50Ij4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI0ZGM0IzMCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNGRjJENTUiLz4KICAgIDwvcmFkaWFsR3JhZGllbnQ+CgogICAgPGZpbHRlciBpZD0icmVkR2xvdyI+CiAgICAgIDxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjIiIHJlc3VsdD0iYmx1ciIvPgogICAgICA8ZmVGbG9vZCBmbG9vZC1jb2xvcj0iI0ZGMkQ1NSIgZmxvb2Qtb3BhY2l0eT0iMC44IiByZXN1bHQ9ImNvbG9yIi8+CiAgICAgIDxmZUNvbXBvc2l0ZSBpbj0iY29sb3IiIGluMj0iYmx1ciIgb3BlcmF0b3I9ImluIiByZXN1bHQ9Imdsb3ciLz4KICAgICAgPGZlTWVyZ2U+CiAgICAgICAgPGZlTWVyZ2VOb2RlIGluPSJnbG93Ii8+CiAgICAgICAgPGZlTWVyZ2VOb2RlIGluPSJnbG93Ii8+CiAgICAgICAgPGZlTWVyZ2VOb2RlIGluPSJTb3VyY2VHcmFwaGljIi8+CiAgICAgIDwvZmVNZXJnZT4KICAgIDwvZmlsdGVyPgogIDwvZGVmcz4KPC9zdmc+Cg==" />

# DialogStream Python Package

This repository contains the Python package for DialogStream, a powerful and flexible conversational AI platform.

## Installation

To install the DialogStream Python package, you can use pip:

```bash
pip install dialogstream
```

## Quick start

```bash
python -m venv .venv && source .venv/bin/activate && pip install dialogstream
```
JSON
```bash
python router.py -s "config/stream.json" -p "config/process.json"
```


## Video stream testing

```bash
ffplay rtsp://192.168.1.2:554/Preview_01_sub
```

```bash
ffmpeg -i rtsp://192.168.1.2:554/Preview_01_sub -c copy -f segment -segment_time 6 -segment_format mp4 -strftime 1 -reset_timestamps 1 "./recordings/%Y%m%d_%H.mp4" -v debug
```



## Usage

Here's a basic example of how to use the DialogStream package:

![image](https://github.com/user-attachments/assets/03a65528-9f94-423c-9fa8-4ac9ccab1cbe)


### Flow configuration (flows.json)
The `config/flows.json` file defines video stream flows:
```json
{
  "flows": [
    {
      "name": "RTSP z detekcją ruchu i zapisaniem obrazów",
      "steps": [
        "rtsp://test1234:test1234@192.168.188.225:554/Preview_01_sub",
        "file:///motion"
      ]
    },
    {
      "name": "Timelapse z obrazów",
      "steps": [
        "file:///motion",
        "file:///timelapses"
      ]
    },
    {
      "name": "Timelapse z obrazów co 1 godzine",
      "steps": [
        "file:///motion",
        "schedule://0 */1 * * *",
        "file:///timelapses"
      ]
    },
    {
      "name": "Timelapse z obrazów co 1 godzine",
      "steps": [
        "file:///motion",
        "schedule://0 */1 * * *",
        "file:///timelapses"
      ]
    },
    {
      "name": "Email z powiadamieniem, gdy pojawi się nowy obiekt",
      "steps": [
        "subscribe://object_detected",
        "email:///info@softreck.dev"
      ]
    },
    {
      "name": "Wysyłanie powiadomienia, gdy pojawi się nowy obiekt",
      "steps": [
        "file:///motion",
        "process://detect_object_on_picture",
        "publish://object_detected"
      ]
    }
  ]
}
```

Each flow contains:
- `name`: A descriptive name for the flow
- `steps`: A list of processing steps, where each step is a URL in the format:
    - `rtsp://` - RTSP source
    - `process://` - Processing step with parameters
    - `file://` - Save to file (supports strftime format)

### Process configuration (process.json)
The `config/process.json` file defines processing rules:
```json
[
  {
    "filter": [
      "rtsp",
      "process://motion",
      "file"
    ],
    "run": [
      "shell://ffmpeg -i $1 -c copy -f segment -segment_time 6 -segment_format mp4 -strftime 1 -reset_timestamps 1 $3"
    ]
  },
  {
    "filter": [
      "rtsp",
      "file"
    ],
    "run": [
      "shell://ffmpeg -i $1 -c copy -f segment -segment_time 6 -segment_format mp4 -strftime 1 -reset_timestamps 1 $2"
    ]
  }
]
```

Each rule contains:
- `filter`: A list of URL patterns to match
- `run`: A list of shell commands to execute, where:
    - `$1, $2, $3...` - refer to the corresponding URLs from the filter section
    - Commands are executed in the order defined in the list




For more detailed information, please refer to the [official documentation](https://github.com/dialogstream-com/python/tree/main/docs).

## Contributing

Contributions are welcome! If you find any bugs or have suggestions for improvements, please open an issue or submit a pull request on GitHub.

## License

This project is licensed under the MIT License - see the [LICENSE](https://github.com/dialogstream-com/python/blob/main/LICENSE) file for details.
