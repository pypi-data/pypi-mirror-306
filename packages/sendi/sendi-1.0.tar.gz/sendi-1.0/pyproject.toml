[project]
name = "sendi"
version = "1.0"
requires-python = ">=3.11"
authors =[
    {name = "Inkey", email = "inkey@inkey-art.net"},
]
description = "Another xmppsend script"
license = "AGPL-3.0-or-later"
readme = "README.md"
classifiers = [
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "License :: OSI Approved :: GNU Affero General Public License v3 or later (AGPLv3+)",
]

dependencies = [
    # Typer Cli
    "typer>=0.7.0",
    # types/validation
    "pydantic>=1.10.4,<3",
    "annotated_types>=0.5.0",
    # xmpp lib
    "slixmpp>=1.8.3",
    "slixmpp-omemo>=1.1.1",
    "OMEMO>=1.1.0",
    "aiohttp>=3.8.4",
    # ssl
    "certifi>=2022.9.24",
    "aiodns>=3.0.0"
]

[project.urls]
Repository="https://framagit.org/inkhey_projects/misc/sendi"


[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"


[tool.rye]
managed = true
dev-dependencies = [
    # tests
    "pytest",
    "pytest-sugar", # nicer pytest
    # typing
    "mypy>=1.4.1",
    # others
    "uv",
    "pre-commit",
    "black",
    "ruff",
]

[project.scripts]
# Typer Cli
sendi = "sendi.cli:app"


[tool.hatch.metadata]
allow-direct-references = true

[tool.ruff]
line-length = 100
target-version = 'py311'

[tool.ruff.lint]
select = [
    "E", # pycodestyle
    "F", # pyflakes
    "W", # pyflakes-warning
    "I", # isort: import order
    "C90", #mccabe: complexity
    "UP", # pyupgrade: new syntax
    "ANN", # Annotation
    "ASYNC", # async
    "S", # bandit
    "FBT", # boolean trap
    "B", # bugbear
    "A", # buildin
    "C4", # comprehension
    "DTZ", # datetime
    "SIM", # simplify
    "TCH", # #typecheck import
    "ARG", # unused arg
    "ERA", # commented code
    "PL", # pylint
    "PLR", # pylint-refactor
    "PLW", # pylint warning
    "TRY", # tryceratops: handling exceptions
    "PERF", # perf anti-pattern
    "RUF", # ruff
]
ignore = [
    "E501", # line too long, handled by black
    "B008", # do not perform function calls in argument defaults
    "ARG001", # unused function arguments
    "ANN101",
    "ANN102",
    "A003",
    "S101",
    "FBT001",
    "FBT002",
    "UP007" # PEP 604 annotation are not properly supported in old typer version
]
[tool.ruff.lint.mccabe]
max-complexity = 10
[tool.ruff.lint.pylint]
max-args = 15



[tool.mypy]
python_version = "3.11"
plugins = [
    "pydantic.mypy",
]
exclude = [
    "^tasks\\.py$"
]

[tool.pytest.ini_options]
log_cli = true
log_cli_level = "INFO"
log_cli_format = "%(asctime)s - %(name)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)"
log_cli_date_format = "%Y-%m-%d %H:%M:%S"
